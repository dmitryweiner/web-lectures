<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no" />

    <title>Basic - NPM</title>
    <link rel="shortcut icon" href="./favicon.ico"/>
    <link rel="stylesheet" href="./dist/reveal.css" />
    <link rel="stylesheet" href="./dist/theme/serif.css" id="theme" />
    <link rel="stylesheet" href="./css/highlight/zenburn.css" />

  </head>
  <body>
    <div class="reveal">
      <div class="slides"><section  data-markdown><script type="text/template">

## NPM

![NPM logo](assets/npm/logo.png)

[все лекции](https://github.com/dmitryweiner/lectures/blob/main/README.md)

[видео](https://drive.google.com/file/d/1lFMBimAdKy3rIZaThYxWYibMKQaT-r21/view?usp=sharing)</script></section><section  data-markdown><script type="text/template">
### Идея
* Зависимости проекта должны быть зафиксированы.
* Должно быть средство установки пакетов, прописанных в зависимостях:
  * PHP: [composer](https://getcomposer.org/).
  * Java: 
    [Gradle](https://javarush.ru/groups/posts/2126-kratkoe-znakomstvo-s-gradle),
    [Maven](https://javarush.ru/groups/posts/2523-chastjh-4osnovih-maven),
    [Ant](https://habr.com/ru/post/323204/).
  * Python: [pip](https://pypi.org/project/pip/).
* Средство должно автоматически определять нужные версии пакетов.
</script></section><section  data-markdown><script type="text/template">
### NPM
* В экосистеме JS роль менеджера пакетов выполняет NPM.
* NPM &mdash; **N**ode **P**ackage **M**anager.
* Устанавливается вместе с [Node.js](https://nodejs.org/en/download/).
</script></section><section  data-markdown><script type="text/template">
### package.json
* Главный конфигурационный файл называется ```package.json``` и располагается в корне проекта.
* Он должен быть в формате [JSON](https://ru.wikipedia.org/wiki/JSON).
* Его можно создать вручную, можно сгенерировать с помощью NPM.
* Файл хранит:
  * Имя проекта.
  * Зависимости от сторонних библиотек.
  * Скрипты запуска.
  * Настройки проекта.</script></section><section  data-markdown><script type="text/template">
### Инициализация проекта
* Для генерации ```package.json``` надо выполнить команду:
```shell
npm init
```
* В ходе создания придётся ответить на вопросы:

```shell
package name: (sample-project) 
version: (1.0.0) 
description: This is sample project
entry point: (index.js) 
test command: 
git repository: https://github.com/dmitryweiner/sample-project
keywords: project sample
author: Dmitry Weiner
license: (ISC) GPL-3.0-or-later
About to write to /home/dmw/projects/sample-project/package.json:

{
  "name": "sample-project",
  "version": "1.0.0",
  "description": "This is sample project",
  "main": "index.js",
  "scripts": {
    "test": "echo \"Error: no test specified\" && exit 1"
  },
  "repository": {
    "type": "git",
    "url": "git+https://github.com/dmitryweiner/sample-project.git"
  },
  "keywords": [
    "project",
    "sample"
  ],
  "author": "Dmitry Weiner",
  "license": "GPL-3.0-or-later",
  "bugs": {
    "url": "https://github.com/dmitryweiner/sample-project/issues"
  },
  "homepage": "https://github.com/dmitryweiner/sample-project#readme"
}


Is this OK? (yes) yes
```</script></section><section  data-markdown><script type="text/template">
### Инициализация проекта
* Если лень отвечать на вопросы, можно запустить ту же команду с ключом `-y`, вопросов не будет:
```shell
npm init -y
```
* ```package.json``` будет создан с дефолтными значениями.</script></section><section  data-markdown><script type="text/template">
### Поля package.json
* [Полный список возможных полей](https://docs.npmjs.com/cli/v8/configuring-npm/package-json).
* name: имя проекта.
* version: версия вида "1.2.3" (обязательно).
* author: автор (обязательно).
* dependencies: список необходимых библиотек.
* devDependencies: библиотеки для разработки.
* license: под какой [лицензией](https://spdx.org/licenses/).
* description: краткое описание проекта.
* keywords: ключевые слова.
* homepage: домашняя страница проекта.
* repository: ссылка на репозиторий.</script></section><section  data-markdown><script type="text/template">
### [Типы лицензий](https://habr.com/ru/post/275995/) 
![licences types](assets/npm/licences.png)</script></section><section  data-markdown><script type="text/template">
### Установка библиотеки
* [Поиск нужной библиотеки: www.npmjs.com](https://www.npmjs.com/).
* Установка:
```shell
npm install %ИМЯ_БИБЛИОТЕКИ%
# сокращённая команда:
npm i %ИМЯ_БИБЛИОТЕКИ%
```
* Установка библиотеки, нужной только для разработки:
```shell
npm install --save-dev %ИМЯ_БИБЛИОТЕКИ%
# сокращённая команда:
npm i -D %ИМЯ_БИБЛИОТЕКИ%
```
* Код библиотек сохраняется в ```./node_modules```.</script></section><section  data-markdown><script type="text/template">
### Различие devDependencies и dependencies
* Зависимости, перечисленные в `dependencies` нужны для сборки проекта для продакшена.
* Зависимости в `devDependencies` нужны только во время разработки и на продакшен попасть не должны.
* Есть ещё `peerDependencies` для зависимостей библиотеки, которые надо устанавливать самостоятельно.
* [Подробнее](https://stackoverflow.com/questions/18875674/whats-the-difference-between-dependencies-devdependencies-and-peerdependencies).</script></section><section  data-markdown><script type="text/template">
### Нужная версия
* При установке можно указывать конкретную версию библиотеки:
```shell
npm i lodash@1.0.0
```
* Можно указывать минорную или мажорную версии:
```shell
npm i lodash@~1.0 # поставит только 1.0.0 - 1.0.9
npm i lodash@^1.0 # поставит любую начиная от 1.0.0 до 1.3.0
```
* Это называется [семантическое версионирование](https://docs.npmjs.com/about-semantic-versioning).
* [Калькулятор версии](https://semver.npmjs.com/).</script></section><section  data-markdown><script type="text/template">
### package-lock.json
* При установке пакетов (библиотек) конкретные версии записываются в `package-lock.json`:

```json
{
  "name": "sample-project",
  "version": "1.0.0",
  "lockfileVersion": 2,
  "requires": true,
  "packages": {
    "": {
      "name": "sample-project",
      "version": "1.0.0",
      "license": "GPL-3.0-or-later",
      "dependencies": {
        "lodash": "~1.0"
      }
    },
    "node_modules/lodash": {
      "version": "1.0.2",
      "resolved": "https://registry.npmjs.org/lodash/-/lodash-1.0.2.tgz",
      "integrity": "sha1-j1dWDIO1n8JwvT1WG2kAQ0MOJVE=",
      "engines": [
        "node",
        "rhino"
      ]
    }
  },
  "dependencies": {
    "lodash": {
      "version": "1.0.2",
      "resolved": "https://registry.npmjs.org/lodash/-/lodash-1.0.2.tgz",
      "integrity": "sha1-j1dWDIO1n8JwvT1WG2kAQ0MOJVE="
    }
  }
}
```</script></section><section  data-markdown><script type="text/template">
### Что коммитить, а что нет
* Коммитить:
  * `package.json`
  * `package-lock.json`: чтобы зафиксировать конкретные версиии пакетов.
* Не коммитить `node_modules`, добавить их в .gitignore:
```gitignore
./node_modules/
```
</script></section><section  data-markdown><script type="text/template">
### node_modules

[![node_modules](assets/npm/node_modules.png)](assets/npm/node_modules.mp4)</script></section><section  data-markdown><script type="text/template">
### Установка всех зависимостей
* Для склонированного проекта встаёт задача установки **всех** зависимостей, перечисленных в `package.json`.
* Это делается командой:
```shell
npm install
# сокращённая команда
npm i
```
* При этом вычисляются версии пакетов в соответствии с указаниями. Если стоит версия ~1.0, может поставится 1.0.0 или 1.0.9.
* При этом обновляется `package-lock.json`.</script></section><section  data-markdown><script type="text/template">
### Установка зависимостей "как у разработчика"
* Если нужно поставить именно те версии пакетов, которые стоят у разработчика, имеет смысл выполнить команду:
```shell
npm ci
```
* При этом ставятся пакеты с версиями из `package-lock.json`.</script></section><section  data-markdown><script type="text/template">
### Удаление библиотеки
* Библиотека удаляется командой:
```shell
npm uninstall lodash
npm un lodash
```
* При этом обновляется package.json и package-lock.json.
* Созависимые библиотеки не будут удалены.
</script></section><section  data-markdown><script type="text/template">
### Скрипты запуска
* В поле scripts следует описать доступные команды для запуска в проекте:
```json
{
    "scripts": {
      "start": "node index.js",
      "test": "jest",
      "lint": "eslint . --fix"
    }
}
```
* Команды вызываются с помощью конструкции `npm run %ИМЯ_КОМАНДЫ%`:
```shell
npm run start # вызывает "node index.js"
```</script></section><section  data-markdown><script type="text/template">
### Консольные команды
* [Полный список команд](https://docs.npmjs.com/cli/v8/commands).
* Полезные:
  * npm audit: поиск уязвимостей в установленных библиотеках.
  * npm ping: попинговать репозиторий npm.
  * npm publish: опубликовать пакет.
  * npm rebuild: пересобрать пакет.</script></section><section  data-markdown><script type="text/template">
### npx
* Команда [npx](https://medium.com/devschacht/introducing-npx-an-npm-package-runner-a72a658cd9e6)
не устанавливает, а скачивает пакет и тут же запускает. Пример:
```shell
npx tsc --out file.js file.ts
npx create-react-app my-app
```
* Раньше ставили пакет глобально (опция -g), но тогда его нужно самостоятельно обновлять, а так пакет
всегда самой последней версии.</script></section><section  data-markdown><script type="text/template">
### Самое частое решение проблем

![solution](assets/npm/solution.png)</script></section><section  data-markdown><script type="text/template">
### Альтернативы NPM
* [Yarn](https://yarnpkg.com/).
  * Намного быстрее.
  * Скачивает библиотеки в несколько потоков.
  * Хранит конфиг в таком же формате.
* [Bower](https://bower.io/).
  * Свой формат конфига. 
  * Классная птица на лого.
  * Любят владельцы MacOS.</script></section><section  data-markdown><script type="text/template">
### Задачи
* Инициализировать проект.
* Поставить библиотеку [`lodash`](https://github.com/lodash/lodash).
* Подключить её и отсортировать массив объектов по полю `age` (можно использовать метод sortBy):
```js
const users = [
    { user: 'fred',   age: 48 },
    { user: 'barney', age: 36 },
    { user: 'fred',   age: 40 },
    { user: 'barney', age: 34 }
];
```
</script></section></div>
    </div>

    <script src="./dist/reveal.js"></script>

    <script src="./plugin/markdown/markdown.js"></script>
    <script src="./plugin/highlight/highlight.js"></script>
    <script src="./plugin/zoom/zoom.js"></script>
    <script src="./plugin/notes/notes.js"></script>
    <script src="./plugin/math/math.js"></script>
    <script>
      function extend() {
        var target = {};
        for (var i = 0; i < arguments.length; i++) {
          var source = arguments[i];
          for (var key in source) {
            if (source.hasOwnProperty(key)) {
              target[key] = source[key];
            }
          }
        }
        return target;
      }

      // default options to init reveal.js
      var defaultOptions = {
        controls: true,
        progress: true,
        history: true,
        center: true,
        transition: 'default', // none/fade/slide/convex/concave/zoom
        plugins: [
          RevealMarkdown,
          RevealHighlight,
          RevealZoom,
          RevealNotes,
          RevealMath
        ]
      };

      // options from URL query string
      var queryOptions = Reveal().getQueryHash() || {};

      var options = extend(defaultOptions, {}, queryOptions);
    </script>


    <script>
      Reveal.initialize(options);
    </script>
  </body>
</html>
