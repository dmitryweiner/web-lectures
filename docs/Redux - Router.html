<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no" />

    <title>Redux - –ú–∞—Ä—à—Ä—É—Ç–∏–∑–∞—Ü–∏—è –≤ Redux</title>
    <link rel="shortcut icon" href="./favicon.ico"/>
    <link rel="stylesheet" href="./dist/reveal.css" />
    <link rel="stylesheet" href="./dist/theme/serif.css" id="theme" />
    <link rel="stylesheet" href="./css/highlight/zenburn.css" />

  </head>
  <body>
    <div class="reveal">
      <div class="slides"><section  data-markdown><script type="text/template">

## –ú–∞—Ä—à—Ä—É—Ç–∏–∑–∞—Ü–∏—è –≤ Redux

![redux router](assets/redux-router/router-meme.png)

[–≤—Å–µ –ª–µ–∫—Ü–∏–∏](https://github.com/dmitryweiner/lectures/blob/main/README.md),
[–≤–∏–¥–µ–æ](https://youtu.be/8lexwi-SCB8)
</script></section><section  data-markdown><script type="text/template">
### –ò–¥–µ—è
* –ù—É–∂–Ω–æ —Å–¥–µ–ª–∞—Ç—å –æ–¥–Ω–æ—Å—Ç—Ä–∞–Ω–∏—á–Ω–æ–µ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ —Å –Ω–µ—Å–∫–æ–ª—å–∫–∏–º–∏ —Å—Ç—Ä–∞–Ω–∏—Ü–∞–º–∏.
* –ü—Ä–∏ –ø–µ—Ä–µ—Ö–æ–¥–µ –º–µ–∂–¥—É —Å—Ç—Ä–∞–Ω–∏—Ü–∞–º–∏ –¥–æ–ª–∂–Ω–∞ –º–µ–Ω—è—Ç—å—Å—è –∞–¥—Ä–µ—Å–Ω–∞—è —Å—Ç—Ä–æ–∫–∞.
* –ï—Å–ª–∏ –Ω–µ –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è Redux, –º–æ–∂–Ω–æ —Å–ø–æ–∫–æ–π–Ω–æ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å [react-router-dom](https://dmitryweiner.github.io/web-lectures/React%20Router.html#/).
* –ù–∞–¥–æ –ø–æ–¥—Ä—É–∂–∏—Ç—å —Ä–æ—É—Ç–µ—Ä –∏ Redux, —á—Ç–æ–±—ã –º–æ–∂–Ω–æ –±—ã–ª–æ –º–µ–Ω—è—Ç—å —Ä–æ—É—Ç—ã –Ω–µ —Ç–æ–ª—å–∫–æ –∏–∑ –∫–æ–º–ø–æ–Ω–µ–Ω—Ç–æ–≤, –Ω–æ –∏ –∏–∑ —ç–∫—à–µ–Ω–æ–≤ –∏ –¥—Ä—É–≥–∏—Ö –º–µ—Å—Ç.
* –î–ª—è —ç—Ç–æ–≥–æ —Ä–æ—É—Ç –∏ –∏—Å—Ç–æ—Ä–∏—è —Ö—Ä–∞–Ω—è—Ç—Å—è –≤ —Å—Ç–æ—Ä–µ!
</script></section><section  data-markdown><script type="text/template">
### –í—ã–±–æ—Ä –±–∏–±–ª–∏–æ—Ç–µ–∫–∏
* –†–∞–Ω—å—à–µ –±—ã —è –ø–æ—Ä–µ–∫–æ–º–µ–Ω–¥–æ–≤–∞–ª [react-router-redux](https://github.com/reactjs/react-router-redux).
* –ù–æ –µ—ë —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–∞ –ø—Ä–µ–∫—Ä–∞—â–µ–Ω–∞ –≤ 2018 –≥–æ–¥—É.
* –ê–≤—Ç–æ—Ä —Å–æ–≤–µ—Ç—É–µ—Ç –ø–µ—Ä–µ—Ö–æ–¥–∏—Ç—å –Ω–∞ [connected-react-router](https://github.com/supasate/connected-react-router).
* –ï—ë –∏ –±—É–¥–µ–º –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å.
* [–≠—Ç–∞ –±–∏–±–ª–∏–æ—Ç–µ–∫–∞ –Ω–µ –µ–¥–∏–Ω—Å—Ç–≤–µ–Ω–Ω–∞—è](https://github.com/markerikson/redux-ecosystem-links/blob/master/routing.md).
</script></section><section  data-markdown><script type="text/template">
### –£—Å—Ç–∞–Ω–æ–≤–∫–∞ –∏ –ø–æ–¥–∫–ª—é—á–µ–Ω–∏–µ
```shell
npm i connected-react-router
npm i -D @types/history # –æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ, –¥–ª—è –∏—Å–ø–æ–ª—å–∑—É—é—â–∏—Ö TS
```
* –°–æ–∑–¥–∞–Ω–∏–µ –æ–±—ä–µ–∫—Ç–∞ ```history```.
  * –î–ª—è standalone —Ö–æ—Å—Ç–∏–Ω–≥–∞ –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è ```createBrowserHistory```. https://domain.com/path
  * –î–ª—è —Ö–æ—Å—Ç–∏–Ω–≥–∞ –≤ –∫–∞—Ç–∞–ª–æ–≥–µ ```createHashHistory```. https://username.github.io/app/#/path
* –î–æ–±–∞–≤–ª—è–µ–º —Ä–µ–¥—å—é—Å–µ—Ä ```router``` –∏ ```routerMiddleware(history)```.
* –û–±–æ—Ä–∞—á–∏–≤–∞–µ–º ```<App>``` –≤ ```<ConnectedRouter>```.
</script></section><section  data-markdown><script type="text/template">
```store/index.ts```

```ts
import { routerMiddleware } from 'connected-react-router';
import createRootReducer from './reducers';
// –¥–ª—è standalone —Ö–æ—Å—Ç–∏–Ω–≥–∞
import { createBrowserHistory } from 'history';
// –¥–ª—è —Ö–æ—Å—Ç–∏–Ω–≥–∞ –≤ –∫–∞—Ç–∞–ª–æ–≥–µ
import { createHashHistory } from 'history';
export const history = createHashHistory();
//
export const rootReducer = createRootReducer(history);
const store = createStore(
    rootReducer,
    applyMiddleware(thunkMiddleware, routerMiddleware(history))
);
export default store;
```</script></section><section  data-markdown><script type="text/template">
```store/reducers/index.ts```

–ü—Ä–µ–¥–ø–æ–ª–∞–≥–∞–µ—Ç—Å—è, —á—Ç–æ —Å—Ç–æ—Ä —É–∂–µ
[—Ä–∞–∑–¥–µ–ª—ë–Ω –Ω–∞ —Å–ø–ª–∞–π—Å—ã](https://redux.js.org/recipes/structuring-reducers/using-combinereducers).

```ts
import { connectRouter } from 'connected-react-router';
import { History } from 'history';
//
const createRootReducer = (history: History) => combineReducers({
    todo: todoReducer,
    filter: filterReducer,
    router: connectRouter(history), // –∫–ª—é—á –æ–±—ä–µ–∫—Ç–∞ —Ç–æ–ª—å–∫–æ "router", –Ω–µ –∏–Ω–∞—á–µ
})
//
export default createRootReducer;
```</script></section><section  data-markdown><script type="text/template">
```index.tsx```

```tsx
import { ConnectedRouter } from 'connected-react-router';
import store, { history } from './store';
//
ReactDOM.render(
    <Provider store={store}>
        <ConnectedRouter history={history}>
            <App />
        </ConnectedRouter>
    </Provider>,
    document.getElementById('root')
);
```</script></section><section  data-markdown><script type="text/template">
### –í–∞–∂–Ω–∞—è –¥–µ—Ç–∞–ª—å —Ä–∞–±–æ—Ç—ã
* –ü—Ä–∏ –ø–µ—Ä–µ—Ö–æ–¥–µ –ø–æ —Ä–æ—É—Ç—É –ø—Ä–æ–∏—Å—Ö–æ–¥–∏—Ç —Å–æ–±—ã—Ç–∏–µ c —Ç–∏–ø–æ–º ```LOCATION_CHANGE```:
```js
const action = {
    type: LOCATION_CHANGE,
    payload: '/path/'
}
```
* –ú–æ–∂–Ω–æ –¥–æ–±–∞–≤–ª—è—Ç—å —Å–≤–æ–∏ —Ä–µ–¥—å—é—Å–µ—Ä—ã –Ω–∞ —ç—Ç–æ —Å–æ–±—ã—Ç–∏–µ:
```js
import { LOCATION_CHANGE } from 'connected-react-router';
//
case LOCATION_CHANGE:
    return {
        ...state,
        someStateProperty: false
    }
```</script></section><section  data-markdown><script type="text/template">
### Switch
* –í–Ω—É—Ç—Ä–∏ ```<App>``` –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è –∫–æ–º–ø–æ–Ω–µ–Ω—Ç ```<Switch>```, –≤ –∫–æ—Ç–æ—Ä–æ–º –ª–µ–∂–∞—Ç –Ω—É–∂–Ω—ã–µ —Ä–æ—É—Ç—ã.
* [–û–∑–Ω–∞–∫–æ–º–∏—Ç—å—Å—è c —Ä–∞–±–æ—Ç–æ–π Route, Switch](https://dmitryweiner.github.io/web-lectures/React%20Router.html#/6).
```js
import { Route, Switch } from 'react-router';
//
<Switch>
    <Route exact path="/" render={() => (<div>Match</div>)} />
    <Route render={() => (<div>Miss</div>)} />
</Switch>
```
* –£—Å—Ç–∞–Ω–æ–≤–∫–∞:
```shell
npm i react-router react-router-dom
npm i -D @types/react-router @types/react-router-dom # –¥–ª—è TS
```
</script></section><section  data-markdown><script type="text/template">
### –ü–µ—Ä–µ—Ö–æ–¥ –ø–æ —Ä–æ—É—Ç–∞–º
* –í –∫–æ–º–ø–æ–Ω–µ–Ω—Ç–µ:
```js
import { Link } from 'react-router-dom';
//
<Link to="/home">Home</Link>
```
* –ò–ª–∏ —Ç–∞–∫:
```js
import { push } from 'connected-react-router';
//
<div onClick={() => {
    push('/login');
}}>login</div>
```  
</script></section><section  data-markdown><script type="text/template">
### –ü–µ—Ä–µ—Ö–æ–¥ –ø–æ —Ä–æ—É—Ç—É –∏–∑ –∞—Å–∏–Ω—Ö—Ä–æ–Ω–Ω–æ–≥–æ —ç–∫—à–µ–Ω–∞
```js
import { push } from 'connected-react-router';
//
export const login = (username, password) => (dispatch) => {
  /* do something before redirection */
  dispatch(push('/home'))
};
```
</script></section><section  data-markdown><script type="text/template">
### –ü–µ—Ä–µ—Ö–æ–¥ –∏–∑ —Å–∞–≥–∏
```js
import { push } from 'connected-react-router'
import { put, call } from 'redux-saga/effects'
//
export function* login(username, password) {
  /* do something before redirection */
  yield put(push('/home'))
}
```</script></section><section  data-markdown><script type="text/template">
### –ü–µ—Ä–µ—Ö–æ–¥ –Ω–∞–∑–∞–¥ –∏–ª–∏ –≤–ø–µ—Ä—ë–¥
```js
import { goBack, goForward, go } from 'connected-react-router';
//
dispatch(goBack()); // –Ω–∞–∑–∞–¥ –ø–æ –∏—Å—Ç–æ—Ä–∏–∏
dispatch(goForward()); // –≤–ø–µ—Ä—ë–¥ –ø–æ –∏—Å—Ç–æ—Ä–∏–∏
dispatch(go(-2)); // –Ω–∞ 2 —à–∞–≥–∞ –Ω–∞–∑–∞–¥
```</script></section><section  data-markdown><script type="text/template">
### –£–∑–Ω–∞—Ç—å —Ç–µ–∫—É—â–∏–µ –ø–∞—Ä–∞–º–µ—Ç—Ä—ã —Ä–æ—É—Ç–µ—Ä–∞
* –û–Ω–∏ –ª–µ–∂–∞—Ç –≤ —Å—Ç–æ—Ä–µ:
```js
state.router.location.pathname // —Ç–µ–∫—É—â–∏–π URL
state.router.location.search // –ø–æ–∏—Å–∫–æ–≤—ã–π –∑–∞–ø—Ä–æ—Å, —Ä–∞–∑–æ–±—Ä–∞–Ω–Ω—ã–π –Ω–∞ –ø–∞—Ä–∞–º–µ—Ç—Ä—ã
state.router.location.hash // —Ç–æ, —á—Ç–æ –ø–æ—Å–ª–µ # –≤ URL
```
* –î–ª—è ```/hello?a=1#123```:
```js
location = {
    pathname: "/hello",
    search: "?a=1",
    hash: "#123",
    query: {
        a: "1"
    }
}
```
</script></section><section ><section data-markdown><script type="text/template">
### –ö–∞–∫ –ø–æ–ª—É—á–∏—Ç—å –ø–∞—Ä–∞–º–µ—Ç—Ä—ã –∏–∑ —Ä–æ—É—Ç–∞ ```route/:id```
* –í—Å—ë –æ—á–µ–Ω—å –ø–ª–æ—Ö–æ, —Ä–∞–∑—Ä–∞–±–æ—Ç—á–∏–∫–∏ –ø—Ä–µ–¥–ª–∞–≥–∞—é—Ç –∫–æ—Å—Ç—ã–ª–∏. 
  –ú–æ–∂–Ω–æ —Å—Ö–æ–¥–∏—Ç—å –ø–æ—Å—Ç–∞–≤–∏—Ç—å üëç –∑–∞ –Ω–æ—Ä–º–∞–ª—å–Ω–æ–µ —Ä–µ—à–µ–Ω–∏–µ –≤ 
  [issue](https://github.com/supasate/connected-react-router/issues/38).
* –ö–æ—Å—Ç—ã–ª—å –ø–æ–ª—É—á—à–µ:

```tsx
import { createMatchSelector } from 'connected-react-router';
import { useSelector } from 'react-redux';
const matchSelector = createMatchSelector<AppState, {id: string}>({ path: '/user/:id' });
function User() {
    const match = useSelector(matchSelector);
    return <>{match?.params.id}</>;
}
```
</script></section><section data-markdown><script type="text/template">
* –ö–æ—Å—Ç—ã–ª—å –ø–æ—Ö—É–∂–µ:

```tsx
import { matchPath } from 'react-router-dom';
import { useSelector } from 'react-redux';
function User() {
    const pathname = useSelector((state: AppState) => state.router.location.pathname);
    const match = matchPath<{id: string}>(
        pathname, // like: /user/123
        { path: '/user/:id' }
    );
    return <>{match?.params.id}</>;
}
```
</script></section></section><section  data-markdown><script type="text/template">
### –ü–æ–ª–µ–∑–Ω—ã–µ —Å—Å—ã–ª–∫–∏
* [–î–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è](https://github.com/supasate/connected-react-router).
* [–ß–∞–í–æ](https://github.com/supasate/connected-react-router/blob/master/FAQ.md).
* [–ü—Ä–∏–º–µ—Ä—ã](https://github.com/supasate/connected-react-router/blob/master/examples).
* [–°–ø–∏—Å–æ–∫ –≤–æ–∑–º–æ–∂–Ω—ã—Ö —Ä–æ—É—Ç–µ—Ä–æ–≤](https://github.com/markerikson/redux-ecosystem-links/blob/master/routing.md).
</script></section></div>
    </div>

    <script src="./dist/reveal.js"></script>

    <script src="./plugin/markdown/markdown.js"></script>
    <script src="./plugin/highlight/highlight.js"></script>
    <script src="./plugin/zoom/zoom.js"></script>
    <script src="./plugin/notes/notes.js"></script>
    <script src="./plugin/math/math.js"></script>
    <script>
      function extend() {
        var target = {};
        for (var i = 0; i < arguments.length; i++) {
          var source = arguments[i];
          for (var key in source) {
            if (source.hasOwnProperty(key)) {
              target[key] = source[key];
            }
          }
        }
        return target;
      }

      // default options to init reveal.js
      var defaultOptions = {
        controls: true,
        progress: true,
        history: true,
        center: true,
        transition: 'default', // none/fade/slide/convex/concave/zoom
        plugins: [
          RevealMarkdown,
          RevealHighlight,
          RevealZoom,
          RevealNotes,
          RevealMath
        ]
      };

      // options from URL query string
      var queryOptions = Reveal().getQueryHash() || {};

      var options = extend(defaultOptions, {}, queryOptions);
    </script>


    <script>
      Reveal.initialize(options);
    </script>
  </body>
</html>
