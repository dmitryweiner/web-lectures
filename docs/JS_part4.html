<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no" />

    <title>JS часть 4</title>
    <link rel="shortcut icon" href="./favicon.ico"/>
    <link rel="stylesheet" href="./dist/reveal.css" />
    <link rel="stylesheet" href="./dist/theme/serif.css" id="theme" />
    <link rel="stylesheet" href="./css/highlight/zenburn.css" />

  </head>
  <body>
    <div class="reveal">
      <div class="slides"><section  data-markdown><script type="text/template">

### JavaScript
#### Работа с DOM
#### События


![js](assets/js/js-logo.png)

[все лекции](https://github.com/dmitryweiner/lectures/blob/main/README.md)

[видео](https://drive.google.com/file/d/1i-5_uKDIrqbF7kTomPHKfkV1xq-v8-gu/view?usp=sharing)</script></section><section  data-markdown><script type="text/template">
### Обращение к DOM'у
* Поиск элементов DOM осуществляется с помощью следующих методов:
    * document.getElementById().
    * document.querySelector().
    * document.querySelectorAll().
    * document.getElementsByTagName().
    * document.getElementsByClassName().
    * document.getElementsByName().
* [Подробнее](https://learn.javascript.ru/searching-elements-dom).</script></section><section  data-markdown><script type="text/template">
### Поиск элемента по ID
```html
<div id="root"></div>
<script>
  const element = document.getElementById("root");
  console.log(element);
__SCRIPT_END__
```</script></section><section  data-markdown><script type="text/template">
### Поиск элемента по [CSS-селектору](https://developer.mozilla.org/ru/docs/Web/CSS/CSS_Selectors)
```html
<ul>
  <li class="selected">Купить еды</li>
  <li>Посадить картошку</li>
</ul>
<script>
  const element = document.querySelector("ul li.selected");
  console.log(element); // <li class="selected">Купить еды</li>
__SCRIPT_END__
```</script></section><section  data-markdown><script type="text/template">
### Оси родитель-потомок и другие
* У найденного элемента можно посмотреть его потомков:
    * childNodes.
    * firstChild.
    * lastChild.
* И его родителя:
    * parentNode.
* [Подробнее](https://learn.javascript.ru/dom-navigation).</script></section><section  data-markdown><script type="text/template">
![DOM axis](assets/js/dom-axis.png)</script></section><section  data-markdown><script type="text/template">
### Коллекции
* Методы поиска по DOM querySelectorAll, getElementsByName и др. возвращают коллекции узлов.
* Коллекции могут быть итерированы с помощью for..of:
```js
for (let node of document.body.childNodes) {
    conslole.log(node); // покажет все узлы из коллекции
}
```
* Коллекцию можно конвертировать в массив для фильтрации или сортировки:
```js
const arr = Array.from(document.body.childNodes);
```</script></section><section  data-markdown><script type="text/template">
### Живые коллекции
* Коллекции являются [живыми](https://htmlacademy.ru/blog/boost/frontend/collections-js) (кроме querySelectorAll) и динамически обновляются при изменении DOM.
* Если мы сохраним ссылку на elem.childNodes и добавим/удалим узлы в DOM, то они появятся в сохранённой коллекции автоматически.</script></section><section  data-markdown><script type="text/template">
### Изменение свойств
* У найденных узлов можно читать и изменять всевозможные свойства:
    * **.innerText**: текст внутри узла.
    * **.innerHTML**: если туда нужно добавить HTML.
    * **.style**.
    * **.width**.
    * **.value** (только для input).

```html
<div id="root"></div>
<script>
  const element = document.getElementById("root");
  element.innerText = "123";
__SCRIPT_END__
```</script></section><section  data-markdown><script type="text/template">
### Чтение свойств
* Точно так же можно прочитать свойства DOM-элементов.
* Это может пригодиться, если надо узнать, что пользователь ввёл в поле ввода:

```html
<input type="text" id="userInput" />
<script>
  const userInput = document.getElementById("userInput");
  console.log(userInput.value);
__SCRIPT_END__
```</script></section><section  data-markdown><script type="text/template">
### Создание элементов
* Для создания элемента можно использовать метод document.createElement:
```html
<div id="root"></div>
<script>
  const newElement = document.createElement("span");
  newElement.innerHTML = "Я просто маленький текстовый элемент";
  document.getElementById("root").appendChild(newElement);
__SCRIPT_END__
```</script></section><section  data-markdown><script type="text/template">
### Создание текста
* Для добавления текста можно вызвать `createTextNode`:
```html
<div id="root"></div>
<script>
  const newText = document.createTextNode("текстовый элемент");
  document.getElementById("root").appendChild(newText);
__SCRIPT_END__
```</script></section><section  data-markdown><script type="text/template">
### Создание элементов
* Есть способ попроще:

```html
<div id="root"></div>
<script>
  document.getElementById("root")
          .innerHTML = "<span>Текстовый элемент</span>";
__SCRIPT_END__
```</script></section><section  data-markdown><script type="text/template">
![inner HTML](assets/js/innerHTML.png)</script></section><section  data-markdown><script type="text/template">
### Удаление элементов
* Находим родителя нужного элемента и удаляем потомка через него:

```html
<div id="root">
  <div id="willBeDeleted"></div>
</div>
<script>
    const element = document.getElementById("willBeDeleted");
    element.parentElement.removeChild(element);
__SCRIPT_END__
```</script></section><section  data-markdown><script type="text/template">
### Обработчики
* Обработчики событий DOM-элементов добавляются с помощью **addEventListener**.
* Удаляются с помощью **removeEventListener**.
```html
<button id="button">Click me!</button>
<script>
    const element = document.getElementById("button");
    element.addEventListener("click", () => {
      console.log("Button clicked!");
    });
__SCRIPT_END__
```
* Устаревший способ:
```html
<button id="button" onclick="onClickHandler()">Click me!</button>
```</script></section><section  data-markdown><script type="text/template">
![click event](assets/js/clickEvents.png)</script></section><section  data-markdown><script type="text/template">
### Типы событий
* DOM-элементы генерируют огромное множество событий. Самые частые:
    * **click**: клик по элементу.
    * **change**: поле ввода изменилось.
    * **blur**: с поля ввода ушёл фокус.
    * **focus**: пришёл фокус.
    * **submit**: форма отправлена.
* [Список всех событий](https://developer.mozilla.org/ru/docs/Web/Events).</script></section><section  data-markdown><script type="text/template">
### Event
* На вход обработчику приходит событие, из которого можно получить
  [много полезной информации](https://developer.mozilla.org/ru/docs/Web/API/Event).
* Поля события зависят от элемента, от которого оно пришло.
* Если это текстовое поле, то результат ввода лежит в **event.target.value**.
* Если это чекбокс, то состояние лежит в **event.target.checked**.

```js
const checkbox = document.getElementById("checkbox");
checkbox.addEventListener("click", event => {
    console.log(event.target.checked);
});
```</script></section><section  data-markdown><script type="text/template">
### Обработчик загрузки страницы
* Вначале выполняются скрипты, подключенные во внешних файлах, потом скрипты в блоке head, потом скрипты в body.
* Когда выполняются скрипты в файлах, DOM ещё не построен, поэтому `getElementById` будет возвращать `null`.
* Чтобы так не было, надо подписаться на событие `DOMContentLoaded`, а в обработчике искать нужные элементы.</script></section><section  data-markdown><script type="text/template">
### Обработчик загрузки страницы
```js
// script.js
const element = document.getElementById("button");
console.log(element); // null!
document.addEventListener("DOMContentLoaded", () => {
  const element = document.getElementById("button");
  element.addEventListener("click", () => {
    console.log("Button clicked!");
  });
});
```

Или проще использовать свойство [`defer`](https://learn.javascript.ru/script-async-defer):
```html
<script defer src="script.js">__SCRIPT_END__
```</script></section><section  data-markdown><script type="text/template">
### Отправка формы
```html
<form id="form">
  <input type="text" id="userInput" />
  <button type="submit">Send</button>
</form>
<script>
  const form = document.getElementById("form");
  form.addEventListener("submit", event => {
    /**
     * Внимание!
     * Нужно вызвать preventDefault, 
     * чтобы форма не перезагружала страницу.
     */
    event.preventDefault();  
    const userInput = document.getElementById("userInput");
    console.log(userInput.value);
  });
__SCRIPT_END__
```</script></section><section  data-markdown><script type="text/template">
### Игра "Нажми на кнопку"
```html
<button id="button" style="position: absolute">
  click me!
</button>
<script>
  const button = document.getElementById("button");
  button.style.top = window.innerHeight/2 + "px";
  button.style.left = window.innerWidth/2 + "px";
  const x = Math.random() * (window.innerHeight - button.clientHeight);
  const y = Math.random() * (window.innerWidth - button.clientWidth);
  button.addEventListener("mouseenter", () => {
      button.style.top = x + "px";
      button.style.left = y + "px";
  });
__SCRIPT_END__
```
</script></section><section  data-markdown><script type="text/template">
### Полезные ссылки
* https://learn.javascript.ru/searching-elements-dom
* https://learn.javascript.ru/dom-navigation
* https://learn.javascript.ru/script-async-defer
</script></section></div>
    </div>

    <script src="./dist/reveal.js"></script>

    <script src="./plugin/markdown/markdown.js"></script>
    <script src="./plugin/highlight/highlight.js"></script>
    <script src="./plugin/zoom/zoom.js"></script>
    <script src="./plugin/notes/notes.js"></script>
    <script src="./plugin/math/math.js"></script>
    <script>
      function extend() {
        var target = {};
        for (var i = 0; i < arguments.length; i++) {
          var source = arguments[i];
          for (var key in source) {
            if (source.hasOwnProperty(key)) {
              target[key] = source[key];
            }
          }
        }
        return target;
      }

      // default options to init reveal.js
      var defaultOptions = {
        controls: true,
        progress: true,
        history: true,
        center: true,
        transition: 'default', // none/fade/slide/convex/concave/zoom
        plugins: [
          RevealMarkdown,
          RevealHighlight,
          RevealZoom,
          RevealNotes,
          RevealMath
        ]
      };

      // options from URL query string
      var queryOptions = Reveal().getQueryHash() || {};

      var options = extend(defaultOptions, {}, queryOptions);
    </script>


    <script>
      Reveal.initialize(options);
    </script>
  </body>
</html>
